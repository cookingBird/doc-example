define(["./AttributeCompression-49f7b62a","./EllipsoidTangentPlane-5d174e43","./buildModuleUrl-d4759655","./Cartesian2-6033fa5d","./Cartographic-67e73ef9","./when-92c6cf3c","./Rectangle-bab7abf0","./TerrainEncoding-033ec28e","./IndexDatatype-4c0e98b8","./Math-92c3b5f7","./PrimitiveType-e79c54d1","./OrientedBoundingBox-871b4ecf","./Check-52a7d806","./GeometryAttribute-9bdde6dc","./WebMercatorProjection-39906b85","./createTaskProcessorWorker","./Intersect-b97e930a","./Cartesian4-ad128b5d","./IntersectionTests-9cfe2e56","./Plane-b5be516c","./Event-3390cd7d","./RuntimeError-c6a62a80","./ComponentDatatype-81047f82","./WebGLConstants-71f10989","./PolygonPipeline-0e701576","./WindingOrder-1b9c8a87","./EllipsoidRhumbLine-8847d1a1","./Buffer-1d0f8963","./RenderState-64cd1633","./BoundingRectangle-418864a2","./Color-45274500","./FeatureDetection-067cb23c"],(function(e,t,r,n,i,o,a,s,c,h,d,u,l,I,m,g,T,y,f,v,w,E,p,b,N,S,A,x,P,_,F,M){"use strict";function B(){l.t.throwInstantiationError()}Object.defineProperties(B.prototype,{errorEvent:{get:l.t.throwInstantiationError},credit:{get:l.t.throwInstantiationError},tilingScheme:{get:l.t.throwInstantiationError},ready:{get:l.t.throwInstantiationError},readyPromise:{get:l.t.throwInstantiationError},hasWaterMask:{get:l.t.throwInstantiationError},hasVertexNormals:{get:l.t.throwInstantiationError},availability:{get:l.t.throwInstantiationError}});var G=[];B.getRegularGridIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=G[e];o.e(r)||(G[e]=r=[]);var n=r[t];return o.e(n)||C(e,t,n=e*t<h.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),n},B.getRegularGridIndicesForReproject=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=G[e];o.e(r)||(G[e]=r=[]);var n=r[t];return o.e(n)||C(e,t,n=e*t<h.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var W=[];B.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=W[e];o.e(r)||(W[e]=r=[]);var n=r[t];if(!o.e(n)){var i=B.getRegularGridIndices(e,t),a=R(e,t),s=a.westIndicesSouthToNorth,c=a.southIndicesEastToWest,d=a.eastIndicesNorthToSouth,u=a.northIndicesWestToEast;n=r[t]={indices:i,westIndicesSouthToNorth:s,southIndicesEastToWest:c,eastIndicesNorthToSouth:d,northIndicesWestToEast:u}}return n};var O=[];function R(e,t){var r,n=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,i[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,n[r]=(t-r-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function C(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,c=s+e,h=c+1,d=s+1;r[n++]=s,r[n++]=c,r[n++]=d,r[n++]=d,r[n++]=c,r[n++]=h,++i}++i}var u=(t-1)/2,l=(e-1)/2;i=0;for(a=0;a<l;a++)r[n++]=i,r[n++]=i+1,r[n++]=i+2,i+=2;i=e*(t-1);for(a=0;a<l;a++)r[n++]=i+1,r[n++]=i,r[n++]=i+2,i+=2;i=0;for(a=0;a<u;a++)r[n++]=i+e,r[n++]=i,r[n++]=i+2*e,i+=2*e;i=e-1;for(a=0;a<u;a++)r[n++]=i,r[n++]=i+e,r[n++]=i+2*e,i+=2*e}function Y(e,t,r,n,i){for(var a=o.e(i),s=e[0],c=e.length,h=1;h<c;++h){var d=e[h];!a||i[s+"_"+d]?(r[n++]=s,r[n++]=d,r[n++]=t,r[n++]=t,r[n++]=d,r[n++]=t+1,s=d,++t):(s=d,++t)}return n}B.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=h.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=O[e];o.e(r)||(O[e]=r=[]);var n=r[t];if(!o.e(n)){var i=e*t,a=(e-1)*(t-1)*6,s=2*e+2*t,d=i+s,u=3*(e+t-2),I=a+6*Math.max(0,s-4)+u,m=R(e,t),g=m.westIndicesSouthToNorth,T=m.southIndicesEastToWest,y=m.eastIndicesNorthToSouth,f=m.northIndicesWestToEast,v=c.IndexDatatype.createTypedArray(d,I);C(e,t,v,0),B.addSkirtIndices(g,T,y,f,i,v,a+u),n=r[t]={indices:v,westIndicesSouthToNorth:g,southIndicesEastToWest:T,eastIndicesNorthToSouth:y,northIndicesWestToEast:f,indexCountWithoutSkirts:a}}return n},B.addSkirtIndices=function(e,t,r,n,i,o,a,s){var c=i;a=Y(e,c,o,a,s),a=Y(t,c+=e.length,o,a,s),a=Y(r,c+=t.length,o,a,s),Y(n,c+=r.length,o,a,s)},B.heightmapTerrainQuality=.25,B.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*B.heightmapTerrainQuality/(t*r)},B.prototype.requestTileGeometry=l.t.throwInstantiationError,B.prototype.getLevelMaximumGeometricError=l.t.throwInstantiationError,B.prototype.getTileDataAvailable=l.t.throwInstantiationError,B.prototype.loadTileDataAvailability=l.t.throwInstantiationError;var k=32767,H=new i.t,V=new i.t,U=new i.t,z=new i.t$1,L=new n.o,D=new i.t,j=new d.y,q=new d.y;function K(e,t,r,n,o,a,s,c,u){var l=Number.POSITIVE_INFINITY,I=o.north,m=o.south,g=o.east,T=o.west;g<T&&(g+=h.e.TWO_PI);for(var y=e.length,f=0;f<y;++f){var v=e[f],w=r[v],E=n[v];z.longitude=h.e.lerp(T,g,E.x),z.latitude=h.e.lerp(m,I,E.y),z.height=w-t;var p=a.cartographicToCartesian(z,H);d.y.multiplyByPoint(s,p,p),i.t.minimumByComponent(p,c,c),i.t.maximumByComponent(p,u,u),l=Math.min(l,z.height)}return l}function Q(t,r,n,a,s,c,u,l,g,T,y,f,v,w,E){var p=o.e(u),b=g.north,N=g.south,S=g.east,A=g.west;S<A&&(S+=h.e.TWO_PI);for(var x=n.length,P=0;P<x;++P){var _=n[P],F=s[_],M=c[_];z.longitude=h.e.lerp(A,S,M.x)+w,z.latitude=h.e.lerp(N,b,M.y)+E,z.height=F-T;var B,G=l.cartographicToCartesian(z,H);if(p){var W=2*_;if(L.x=u[W],L.y=u[W+1],1!==y){var O=e.t.octDecode(L.x,L.y,D),R=I.m.eastNorthUpToFixedFrame(H,l,q),C=d.y.inverseTransformation(R,j);d.y.multiplyByPointAsVector(C,O,O),O.z*=y,i.t.normalize(O,O),d.y.multiplyByPointAsVector(R,O,O),i.t.normalize(O,O),e.t.octEncode(O,L)}}a.hasWebMercatorT&&(B=(m.t.geodeticLatitudeToMercatorAngle(z.latitude)-f)*v),r=a.encode(t,r,G,M,z.height,L,B)}}function X(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),o.e(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}var Z=g((function(l,g){var T,y,f=l.quantizedVertices,v=f.length/3,w=l.octEncodedNormals,E=l.westIndices.length+l.eastIndices.length+l.southIndices.length+l.northIndices.length,p=l.includeWebMercatorT,b=a.h.clone(l.rectangle),N=b.west,S=b.south,A=b.east,x=b.north,P=a.t.clone(l.ellipsoid),_=l.exaggeration,F=l.minimumHeight*_,M=l.maximumHeight*_,G=o.e(l.validMinimumHeight)?l.validMinimumHeight*_:F*_,W=o.e(l.validMaximumHeight)?l.validMaximumHeight*_:M*_,O=l.relativeToCenter,R=I.m.eastNorthUpToFixedFrame(O,P),C=d.y.inverseTransformation(R,new d.y);p&&(T=m.t.geodeticLatitudeToMercatorAngle(S),y=1/(m.t.geodeticLatitudeToMercatorAngle(x)-T));var Y=f.subarray(0,v),Z=f.subarray(v,2*v),$=f.subarray(2*v,3*v),J=o.e(w),ee=new Array(v),te=new Array(v),re=new Array(v),ne=p?new Array(v):[],ie=V;ie.x=Number.POSITIVE_INFINITY,ie.y=Number.POSITIVE_INFINITY,ie.z=Number.POSITIVE_INFINITY;var oe=U;oe.x=Number.NEGATIVE_INFINITY,oe.y=Number.NEGATIVE_INFINITY,oe.z=Number.NEGATIVE_INFINITY;for(var ae=Number.POSITIVE_INFINITY,se=Number.NEGATIVE_INFINITY,ce=Number.POSITIVE_INFINITY,he=Number.NEGATIVE_INFINITY,de=0;de<v;++de){var ue=Y[de],le=Z[de],Ie=ue/k,me=le/k,ge=h.e.lerp(F,M,$[de]/k);z.longitude=h.e.lerp(N,A,Ie),z.latitude=h.e.lerp(S,x,me),z.height=ge,ae=Math.min(z.longitude,ae),se=Math.max(z.longitude,se),ce=Math.min(z.latitude,ce),he=Math.max(z.latitude,he);var Te=P.cartographicToCartesian(z);ee[de]=new n.o(Ie,me),te[de]=ge,re[de]=Te,p&&(ne[de]=(m.t.geodeticLatitudeToMercatorAngle(z.latitude)-T)*y),d.y.multiplyByPoint(C,Te,H),i.t.minimumByComponent(H,ie,ie),i.t.maximumByComponent(H,oe,oe)}var ye,fe,ve=X(l.westIndices,(function(e,t){return ee[e].y-ee[t].y})),we=X(l.eastIndices,(function(e,t){return ee[t].y-ee[e].y})),Ee=X(l.southIndices,(function(e,t){return ee[t].x-ee[e].x})),pe=X(l.northIndices,(function(e,t){return ee[e].x-ee[t].x}));fe=r.i.fromPoints(re),ye=u.x.fromRectangle(b,F,M,P);var be,Ne=u.x.fromRectangle(b,G,W,P);(1!==_||F<0)&&(be=new s.s(P).computeHorizonCullingPointPossiblyUnderEllipsoid(O,re,F));var Se=F;Se=Math.min(Se,K(l.westIndices,l.westSkirtHeight,te,ee,b,P,C,ie,oe)),Se=Math.min(Se,K(l.southIndices,l.southSkirtHeight,te,ee,b,P,C,ie,oe)),Se=Math.min(Se,K(l.eastIndices,l.eastSkirtHeight,te,ee,b,P,C,ie,oe)),Se=Math.min(Se,K(l.northIndices,l.northSkirtHeight,te,ee,b,P,C,ie,oe));for(var Ae=new t.e(ie,oe,O),xe=new s.h(Ae,Se,M,R,J,p),Pe=xe.getStride(),_e=new Float32Array(v*Pe+E*Pe),Fe=0,Me=0;Me<v;++Me){if(J){var Be=2*Me;if(L.x=w[Be],L.y=w[Be+1],1!==_){var Ge=e.t.octDecode(L.x,L.y,D),We=I.m.eastNorthUpToFixedFrame(re[Me],P,q),Oe=d.y.inverseTransformation(We,j);d.y.multiplyByPointAsVector(Oe,Ge,Ge),Ge.z*=_,i.t.normalize(Ge,Ge),d.y.multiplyByPointAsVector(We,Ge,Ge),i.t.normalize(Ge,Ge),e.t.octEncode(Ge,L)}}Fe=xe.encode(_e,Fe,re[Me],ee[Me],te[Me],L,ne[Me])}var Re=Math.max(0,2*(E-4)),Ce=l.indices.length+3*Re,Ye=c.IndexDatatype.createTypedArray(v+E,Ce);Ye.set(l.indices,0);var ke=1e-4,He=(se-ae)*ke,Ve=(he-ce)*ke,Ue=-He,ze=He,Le=Ve,De=-Ve,je=v*Pe;Q(_e,je,ve,xe,te,ee,w,P,b,l.westSkirtHeight,_,T,y,Ue,0),Q(_e,je+=l.westIndices.length*Pe,Ee,xe,te,ee,w,P,b,l.southSkirtHeight,_,T,y,0,De),Q(_e,je+=l.southIndices.length*Pe,we,xe,te,ee,w,P,b,l.eastSkirtHeight,_,T,y,ze,0),Q(_e,je+=l.eastIndices.length*Pe,pe,xe,te,ee,w,P,b,l.northSkirtHeight,_,T,y,0,Le);var qe=function(e,t,r,n){if(n<12)return;for(var i={},o=e.length,a=0;a<o;a+=3){var s=e[a],c=e[a+1],h=e[a+2];(t[s]===k&&t[c]===k||0===t[s]&&0===t[c]||r[s]===k&&r[c]===k||0===r[s]&&0===r[c])&&(i[s+"_"+c]=1,i[c+"_"+s]=1),(t[c]===k&&t[h]===k||0===t[c]&&0===t[h]||r[c]===k&&r[h]===k||0===r[c]&&0===r[h])&&(i[c+"_"+h]=1,i[h+"_"+c]=1),(t[h]===k&&t[s]===k||0===t[h]&&0===t[s]||r[h]===k&&r[s]===k||0===r[h]&&0===r[s])&&(i[h+"_"+s]=1,i[s+"_"+h]=1)}return i}(l.indices,Y,Z,l.level);return B.addSkirtIndices(ve,Ee,we,pe,v,Ye,l.indices.length,qe),g.push(_e.buffer,Ye.buffer),{vertices:_e.buffer,indices:Ye.buffer,westIndicesSouthToNorth:ve,southIndicesEastToWest:Ee,eastIndicesNorthToSouth:we,northIndicesWestToEast:pe,vertexStride:Pe,center:O,minimumHeight:F,maximumHeight:M,boundingSphere:fe,orientedBoundingBox:ye,validOrientedBoundingBox:Ne,occludeePointInScaledSpace:be,encoding:xe,indexCountWithoutSkirts:l.indices.length}}));return Z}));
